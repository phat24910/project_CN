<nz-card *ngIf="product" class="max-w-4xl mx-auto p-6 shadow-lg rounded-2xl">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="flex flex-col md:flex-row gap-4 items-start">
      <div class="hidden md:flex flex-col gap-2">
        <img *ngFor="let img of product.images; let idx = index"
             [src]="img"
             (click)="selectedImageIdx = idx"
             [class]="'w-16 h-16 object-cover rounded border cursor-pointer transition ring-2 ' + (selectedImageIdx === idx ? 'ring-orange-500 border-orange-500' : 'ring-transparent border-gray-200')"
             [alt]="product.title + ' thumbnail'" />
      </div>

      <div class="relative w-full flex flex-col items-center">
        <img [src]="product.images?.[selectedImageIdx || 0] || product.thumbnail"
             [alt]="product.title"
             class="w-full h-80 object-contain bg-white rounded-xl border shadow mb-2" />
        <button *ngIf="product.images?.length > 1" nz-button nzShape="circle" nzType="default" class="absolute top-1/2 left-2 -translate-y-1/2 z-10 bg-white/80" (click)="prevImage()">
          <span nz-icon nzType="left"></span>
        </button>
        <button *ngIf="product.images?.length > 1" nz-button nzShape="circle" nzType="default" class="absolute top-1/2 right-2 -translate-y-1/2 z-10 bg-white/80" (click)="nextImage()">
          <span nz-icon nzType="right"></span>
        </button>
        <!-- Thumbnails ngang dưới ảnh -->
        <div class="flex md:hidden gap-2 mt-2 justify-center">
          <img *ngFor="let img of product.images; let idx = index"
               [src]="img"
               (click)="selectedImageIdx = idx"
               [class]="'w-14 h-14 object-cover rounded border cursor-pointer transition ring-2 ' + (selectedImageIdx === idx ? 'ring-orange-500 border-orange-500' : 'ring-transparent border-gray-200')"
               [alt]="product.title + ' thumbnail'" />
        </div>
      </div>
    </div>

    <!-- Thông tin chi tiết -->
    <div>
      <h2 class="text-3xl font-bold text-gray-800 mb-2">{{ product.title }}</h2>
      <div class="text-base text-gray-500 mb-2">{{'productDetail.sku' | transloco}}: {{ product.sku }}</div>
      <div class="mb-3 flex items-center gap-3">
        <span class="text-orange-500 text-2xl font-bold">{{ product.price | currency:'USD' }}</span>
        <span *ngIf="product.discountPercentage" class="text-red-600 font-semibold bg-red-100 px-2 py-1 rounded">-{{ product.discountPercentage }}%</span>
        <span class="text-xs text-gray-500">{{'productDetail.stock' | transloco}}: {{ product.stock }}</span>
      </div>
      <nz-rate [ngModel]="product.rating" [nzDisabled]="true" [nzAllowHalf]="true" class="mb-2"></nz-rate>
      <span class="text-gray-500 text-xs">({{ product.rating }} {{'productDetail.stars' | transloco}})</span>

      <nz-descriptions nzBordered [nzColumn]="1" class="mt-4 bg-white rounded-lg">
        <nz-descriptions-item [nzTitle]="'productDetail.category' | transloco">{{ product.category }}</nz-descriptions-item>
        <nz-descriptions-item [nzTitle]="'productDetail.weight' | transloco">{{ product.weight }} kg</nz-descriptions-item>
        <nz-descriptions-item [nzTitle]="'productDetail.dimensions' | transloco">
          {{ product.dimensions.width }} × {{ product.dimensions.height }} × {{ product.dimensions.depth }} cm
        </nz-descriptions-item>
        <nz-descriptions-item [nzTitle]="'productDetail.availability' | transloco">{{ product.availabilityStatus }}</nz-descriptions-item>
        <nz-descriptions-item [nzTitle]="'productDetail.warranty' | transloco">{{ product.warrantyInformation }}</nz-descriptions-item>
        <!-- <nz-descriptions-item [nzTitle]="'productDetail.shippingInformation' | transloco">{{ product.shippingInformation }}</nz-descriptions-item> -->
        <!-- <nz-descriptions-item [nzTitle]="'productDetail.minimumOrderQuantity' | transloco">{{ product.minimumOrderQuantity }}</nz-descriptions-item> -->
        <nz-descriptions-item [nzTitle]="'productDetail.returnPolicy' | transloco">{{ product.returnPolicy }}</nz-descriptions-item>
      </nz-descriptions>

      <!-- <div *ngIf="product.tags?.length" class="mt-3">
        <span class="font-semibold">Tags:</span>
        <nz-tag *ngFor="let tag of product.tags" nzColor="blue" class="mx-1">{{ tag }}</nz-tag>
      </div>

      <div *ngIf="product.meta" class="mt-3">
        <nz-descriptions nzBordered [nzColumn]="1">
          <nz-descriptions-item nzTitle="Barcode">{{ product.meta.barcode }}</nz-descriptions-item>
          <nz-descriptions-item nzTitle="Tạo lúc">{{ product.meta.createdAt | date:'short' }}</nz-descriptions-item>
          <nz-descriptions-item nzTitle="Cập nhật">{{ product.meta.updatedAt | date:'short' }}</nz-descriptions-item>
        </nz-descriptions>
        <img *ngIf="product.meta.qrCode" [src]="product.meta.qrCode" alt="QR Code" class="h-24 mt-2 mx-auto" />
      </div> -->

      <div class="flex gap-3 mt-6">
        <button
          nz-button
          nzType="primary"
          (click)="buyNow()"
          class="text-white font-semibold border-primary"
          style="background-color: #ff6600 !important; border-color: #ff6600 !important; box-shadow: none;"
        >
          {{'productDetail.buyNow' | transloco}}
        </button>
        <button
          nz-button
          nzType="default"
          (click)="addToCart()"
          style="border-color: #ff6600 !important; color: #ff6600 !important;"
        >
          {{'productDetail.addToCart' | transloco}}
        </button>
      </div>
    </div>
  </div>

  <div class="mt-8">
    <h3 class="text-xl font-semibold mb-2">{{ 'productDetail.userReviews' | transloco }}</h3>
    <div *ngIf="product.reviews?.length; else noReview">
      <div *ngFor="let r of product.reviews" class="border rounded p-3 mb-3 bg-gray-50">
        <div class="font-semibold">{{ r.reviewerName }} <span class="text-yellow-500">({{ r.rating }}/5)</span></div>
        <div class="italic text-xs text-gray-500">{{ r.date | date:'medium' }}</div>
        <div>{{ r.comment }}</div>
      </div>
    </div>
    <ng-template #noReview>
      <div class="text-gray-400 italic">{{ 'productDetail.noReviews' | transloco }}</div>
    </ng-template>
  </div>
</nz-card>

